<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kdedevelop.mediani.user.adapter.out.mybatis.UserMyBatisRepository">
    <resultMap id="userResultMap" type="UserMyBatisEntity">
        <id property="id" column="user_id"/>
        <result property="loginId" column="user_login_id"/>
        <result property="password" column="user_password"/>
        <result property="name" column="user_name"/>
        <result property="expiredAt" column="user_expired_at"/>
        <result property="createdAt" column="user_created_at"/>
        <result property="updatedAt" column="user_updated_at"/>
        <result property="lock" column="user_lock"/>
        <result property="enable" column="user_enable"/>
        <result property="role" column="user_role"/>
    </resultMap>

    <!-- CREATE -->
    <insert id="create" parameterType="UserMyBatisEntity">
        INSERT INTO `user` (`id`, `login_id`, `password`, `name`, `expired_at`, `created_at`, `updated_at`, `lock`, `enable`, `role`)
        VALUES (#{user.id}, #{user.loginId}, #{user.password}, #{user.name}, #{user.expiredAt}, #{user.createdAt}, #{user.updatedAt}, #{user.lock}, #{user.enable}, #{user.role})
    </insert>

    <!-- READ by ID -->
    <select id="readById" resultMap="userResultMap" parameterType="short">
        SELECT id as user_id, login_id as user_login_id, password as user_password, name as user_name, expired_at as user_expired_at, created_at as user_created_at, updated_at as user_update_at, `lock` as user_lock, enable as user_enable, role as user_role
        FROM `user`
        WHERE id = #{id}
    </select>

    <!-- READ first by order desc -->
    <select id="readFirstByOrderByIdDesc" resultMap="userResultMap">
        SELECT id as user_id, login_id as user_login_id, password as user_password, name as user_name, expired_at as user_expired_at, created_at as user_created_at, updated_at as user_updated_at, `lock` as user_lock, enable as user_enable, role as user_role
        FROM `user`
        ORDER BY id DESC
        LIMIT 1
    </select>

    <select id="readByLoginId" resultMap="userResultMap">
        SELECT id as user_id, login_id as user_login_id, password as user_password, name as user_name, expired_at as user_expired_at, created_at as user_created_at, updated_at as user_updated_at, `lock` as user_lock, enable as user_enable, role as user_role
        FROM `user`
        WHERE login_id LIKE #{loginId}
    </select>

    <select id="existsByLoginId" resultType="boolean">
        SELECT id as user_id, login_id as user_login_id, password as user_password, name as user_name, expired_at as user_expired_at, created_at as user_created_at, updated_at as user_updated_at, `lock` as user_lock, enable as user_enable, role as user_role
        FROM `user`
        WHERE login_id LIKE #{loginId}
    </select>

    <!-- UPDATE -->
    <update id="update" parameterType="UserMyBatisEntity">
        UPDATE `user`
        SET password = #{user.password}, name = #{user.name}, expired_at = #{user.expiredAt}, updated_at = #{user.updatedAt}, `lock` = #{user.lock}, `enable` = #{user.enable}, role = #{user.role}
        WHERE id = #{user.id}
    </update>
</mapper>